import{D as U,E as W,b9 as J,G as X,ba as K,H as n,J as $,bb as V,M as Y,aW as Z,b4 as ee,a1 as A,bc as P,bd as I,be as R,bf as B,bg as D,bh as m,bi as u,bj as F,bk as re,A as O,bl as g,bm as q,bn as w,bo as G,bp as te}from"./index.b340747c.js";import{u as ae,a as M,r as H}from"./urlImage.0db39262.js";import"./dayjs.937bb0b8.js";const se={xs:2,sm:4,md:6,lg:10,xl:14};function N(e,s,i){return{transform:s===!0?`translateX(${i.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}var ie=U({name:"QLinearProgress",props:{...W,...J,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:s}){const{proxy:i}=Y(),S=X(e,i.$q),f=K(e,se),h=n(()=>e.indeterminate===!0||e.query===!0),_=n(()=>e.reverse!==e.query),x=n(()=>({...f.value!==null?f.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),k=n(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),C=n(()=>N(e.buffer!==void 0?e.buffer:1,_.value,i.$q)),b=n(()=>`with${e.instantFeedback===!0?"out":""}-transition`),E=n(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${b.value} q-linear-progress__track--${S.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),t=n(()=>N(h.value===!0?1:e.value,_.value,i.$q)),r=n(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${b.value} q-linear-progress__model--${h.value===!0?"in":""}determinate`),o=n(()=>({width:`${e.value*100}%`})),l=n(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${b.value}`);return()=>{const a=[$("div",{class:E.value,style:C.value}),$("div",{class:r.value,style:t.value})];return e.stripe===!0&&h.value===!1&&a.push($("div",{class:l.value,style:o.value})),$("div",{class:k.value,style:x.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},V(s.default,a))}}});function y(e){return e<10?`0${e}`:`${e}`}function ce(e){let s=~~(e/60);if(e-=s*60,s<60)return`${y(s)}:${y(~~e)}`;const i=~~(s/60);return s-=i*60,`${y(i)}:${y(s)}:${y(~~e)}`}function p(e){return e.slice(0,e.lastIndexOf("$")>>>0)}function oe(e){return e?O(e).isToday():!1}const de=Z("history",()=>{const e=ee(),s=A(null),[i,S]=ae(n(()=>(s.value=null,e.uid?P(D(m,"users",e.uid,"history"),B("timestamp","!=",null),R("timestamp","desc"),I(30)):null)),null,{errorHandler(t){s.value=t}}),f=A(!1),h=n(()=>{if(!f.value)return null;if(!i.value)return;const t=[];return i.value.forEach(r=>{!r.last||!r.name||(r.poster=M(r.poster),t.push(r))}),t});async function _(t){if(!e.uid)throw new Error(u.global.t("errors.require_login_to",[u.global.t("xem-lich-su-gan-day")]));const r=[],{docs:o}=await F(P(D(m,"users",e.uid,"history"),B("timestamp","!=",null),R("timestamp","desc"),...t?[re(t)]:[],I(30)));return o.forEach(l=>{var c;const a=l.data();a.name&&a.last&&r.push({id:l.id,...a,poster:M(a.poster),timestamp:O((c=a.timestamp)==null?void 0:c.toDate()),$doc:l})}),r}async function x(t,r){if(!e.uid)throw new Error(u.global.t("errors.require_login_to",[u.global.t("luu-tien-trinh-xem-season-moi")]));const o=g(g(m,"users",e.uid),"history",p(t)),l=await q(o);(!l.exists()||l.data().season!==t)&&await w(o,{season:t,...r,poster:H(r.poster),timestamp:G()})}function k(t){if(!e.uid)throw new Error(u.global.t("errors.require_login_to",[u.global.t("xem-lich-su-gan-day")]));return F(D(m,"users",e.uid,"history",p(t),"chaps")).then(({docs:r})=>r)}function C(t,r){if(!e.uid)throw new Error(u.global.t("errors.require_login_to",[u.global.t("xem-lich-su-gan-day")]));return q(g(m,"users",e.uid,"history",p(t),"chaps",r)).then(o=>o.data())}function b(t,r,o,l){if(!e.uid)throw new Error(u.global.t("errors.require_login_to",[u.global.t("luu-lich-su-xem")]));const a=p(t),c=g(m,"users",e.uid,"history",a),Q=g(c,"chaps",r);return Promise.all([F(P(c.parent,B("timestamp","!=",null),R("timestamp","desc"),I(1))).then(async({docs:d,size:T})=>{var z;let v=null;T!==0&&(d[0].id!==a&&!d[0].id.endsWith(`#${a}`)||!oe((z=d[0].data().timestamp)==null?void 0:z.toDate()))&&(v=await q(c)),await Promise.all([w(c,{timestamp:G(),season:t,...l,poster:H(l.poster),last:{chap:r,...o}},{merge:!0}),(async()=>{if(v!=null&&v.exists()){const L=v.data(),j=g(c.parent,`${te()}#${a}`);return w(j,{...L,poster:H(L.poster)},{merge:!0})}})()])}).catch(d=>{console.error("error with progress getDocs",d)}),w(Q,o,{merge:!0}).catch(d=>console.error("update progress error",d))])}async function E(t){var o,l;if(!e.uid)throw new Error(u.global.t("errors.require_login_to",[u.global.t("xem-lich-su-gan-day")]));const r=await q(g(m,"users",e.uid,"history",p(t))).then(a=>a.data());return(l=(o=r==null?void 0:r.last)==null?void 0:o.chap)!=null?l:null}return{last30Item:h,last30ItemError:s,refreshLast30Item:S,last30ItemGet:f,loadMoreAfter:_,createSeason:x,getProgressChaps:k,getProgressChap:C,setProgressChap:b,getLastEpOfSeason:E}});export{ie as Q,p as g,ce as p,de as u};
