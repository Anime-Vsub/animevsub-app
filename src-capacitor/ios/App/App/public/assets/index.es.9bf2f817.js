import{ab as ne,ac as Q,a1 as b,ad as $,H as y,ae as U,a2 as G,z as te}from"./index.b340747c.js";const re={},oe=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),ae=()=>re,ue=e=>Array.isArray(e),K=e=>e!==null&&typeof e=="object",z=e=>e instanceof Function,B=e=>e==null,H=typeof window=="undefined",J=()=>{var e;return H||B((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},ie=()=>{var e,t;return(e=!H&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},j=()=>new Promise(()=>{}),x=e=>te(e)?e.value:e,se=e=>K(e)?Object.assign(ue(e)?[]:{},e):e,F=new Map,le=e=>B(e)?void 0:F.get(e),ce=(e,t,n)=>{const o=F.get(e);o!=null&&o.timer&&clearTimeout(o.timer);const a=setTimeout(()=>F.delete(e),t);F.set(e,{...n,timer:a})},A=e=>e;function X(e,t,n){let o,a,i,s,r,u,l=0,g=!1,w=!1,m=!0;const E=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,K(n)&&(g=!!n.leading,w="maxWait"in n,i=w?Math.max(+n.maxWait||0,t):i,m="trailing"in n?!!n.trailing:m);function d(f){const P=o,I=a;return o=a=void 0,l=f,s=e.apply(I,P),s}function p(f,P){return E?(window.cancelAnimationFrame(r),window.requestAnimationFrame(f)):setTimeout(f,P)}function c(f){if(E)return window.cancelAnimationFrame(f);clearTimeout(f)}function h(f){return l=f,r=p(R,t),g?d(f):s}function v(f){const P=f-u,I=f-l,Y=t-P;return w?Math.min(Y,i-I):Y}function T(f){const P=f-u,I=f-l;return u===void 0||P>=t||P<0||w&&I>=i}function R(){const f=Date.now();if(T(f))return C(f);r=p(R,v(f))}function C(f){return r=void 0,m&&o?d(f):(o=a=void 0,s)}function L(){r!==void 0&&c(r),l=0,o=u=a=r=void 0}function O(){return r===void 0?s:C(Date.now())}function _(){return r!==void 0}function S(...f){const P=Date.now(),I=T(P);if(o=f,a=this,u=P,I){if(r===void 0)return h(u);if(w)return r=p(R,t),d(u)}return r===void 0&&(r=p(R,t)),s}return S.cancel=L,S.flush=O,S.pending=_,S}function fe(e,t,n){let o=!0,a=!0;if(typeof e!="function")throw new TypeError("Expected a function");return K(n)&&(o="leading"in n?!!n.leading:o,a="trailing"in n?!!n.trailing:a),X(e,t,{leading:o,trailing:a,maxWait:t})}var de=A((e,{debounceInterval:t,debounceOptions:n,manual:o})=>{const a=b(!1),i=b(),s=y(()=>n),r=y(()=>x(t)),u=b(e.context.runAsync);return o||(a.value=!0),U(l=>{B(r.value)||(i.value=X(g=>g(),r.value,s.value),e.context.runAsync=(...g)=>new Promise((w,m)=>{a.value?(a.value=!1,u.value(...g).then(w).catch(m)):i.value(()=>{u.value(...g).then(w).catch(m)})}),l(()=>{var g;(g=i.value)===null||g===void 0||g.cancel(),e.context.runAsync=u.value}))}),{onCancel(){var l;(l=i.value)===null||l===void 0||l.cancel()}}}),ve=A((e,{errorRetryCount:t=0,errorRetryInterval:n=0})=>{const o=b(),a=b(0),i=y(()=>x(t)),s=y(()=>x(n));let r=!1;const u=()=>{a.value=0},l=y(()=>{if(s.value)return s.value;const m=1e3,E=1,d=9,p=Math.floor(Math.random()*2**Math.min(a.value,d)+E);return m*p}),g=()=>{let m;const E=i.value===-1,d=a.value<i.value;return(E||d)&&(E||(a.value+=1),m=setTimeout(()=>{r=!0,e.context.refresh()},l.value)),()=>m&&clearTimeout(m)},w=()=>{o.value&&o.value()};return{onBefore(){r||u(),r=!1,w()},onSuccess(){u()},onError(){o.value=g()},onCancel(){u(),w()}}}),me=A((e,{ready:t=b(!0),manual:n,defaultParams:o=[]})=>(G(t,a=>{!n&&a&&e.context.run(...o)},{flush:"sync"}),{onBefore(){if(!t.value)return e.loading.value=!1,{isBreak:!0}}})),ge=A((e,{refreshDeps:t=[],refreshDepsAction:n,manual:o})=>(t!=null&&t.length&&G(t,()=>{n?n():!o&&e.context.refresh()}),{})),he=A((e,{throttleInterval:t,throttleOptions:n})=>{const o=b(),a=y(()=>x(t)),i=y(()=>n),s=b(e.context.runAsync);return U(r=>{if(B(t))return{};o.value=fe(u=>u(),a.value,i.value),e.context.runAsync=(...u)=>new Promise((l,g)=>{o.value(()=>{s.value(...u).then(l).catch(g)})}),r(()=>{var u;(u=o.value)===null||u===void 0||u.cancel(),e.context.runAsync=s.value})}),{onCancel(){var r;(r=o.value)===null||r===void 0||r.cancel()}}});const Re=(e,t)=>n=>{Object.keys(n).forEach(o=>{e[o].value=n[o]}),t.forEach(o=>o(e))},Ee=(e,t)=>()=>{let n=t;for(let o=e.length;o-- >0;)n=e[o](n);return n()},we=(e,t,n)=>{var o,a;const{initialData:i,onSuccess:s,onError:r,onBefore:u,onAfter:l}=t,g=b((o=n==null?void 0:n.loading)!==null&&o!==void 0?o:!1),w=$((a=n==null?void 0:n.data)!==null&&a!==void 0?a:i),m=$(n==null?void 0:n.error),E=b(n==null?void 0:n.params),d=b([]),p=$("pending"),c={},h=Re({status:p,loading:g,data:w,error:m,params:E},[]),v=(R,...C)=>{if(R==="onQuery"){const L=d.value.map(O=>O.onQuery).filter(Boolean);return{servicePromise:Ee(L,C[0])()}}else{const L=d.value.map(O=>{var _;return(_=O[R])===null||_===void 0?void 0:_.call(O,...C)});return Object.assign({},...L)}},T=b(0);return c.runAsync=async(...R)=>{h({loading:!0,params:R,status:"pending"}),T.value+=1;const C=T.value,{isBreak:L,breakResult:O=j()}=v("onBefore",R);if(L)return h({status:"settled"}),O;u==null||u(R);try{const _=()=>new Promise(P=>P(e(...E.value)));let{servicePromise:S}=v("onQuery",_);S||(S=_());const f=await S;return C!==T.value?j():(h({data:f,loading:!1,error:void 0,status:"settled"}),v("onSuccess",f,R),s==null||s(f,R),v("onAfter",R,f,void 0),l==null||l(R),f)}catch(_){if(C!==T.value)return j();throw h({loading:!1,error:_,status:"settled"}),v("onError",_,R),r==null||r(_,R),v("onAfter",R,void 0,_),l==null||l(R),_}},c.run=(...R)=>{c.runAsync(...R).catch(C=>{r||console.error(C)})},c.cancel=()=>{T.value+=1,h({loading:!1}),v("onCancel")},c.refresh=()=>{c.run(...E.value||[])},c.refreshAsync=()=>c.runAsync(...E.value||[]),c.mutate=R=>{const C=z(R)?R(w.value):R,L=se(C);h({data:L}),v("onMutate",L)},{status:p,loading:g,data:w,error:m,params:E,plugins:d,context:c}};function pe(e,t={},n){const o=ne(oe,{}),a={...ae(),...o,...t},{manual:i=!1,defaultParams:s=[]}=a,r=we(e,a);if(r.plugins.value=n.map(u=>u(r,a)),!i){const u=r.params.value||s;r.context.run(...u)}return Q(()=>{r.context.cancel()}),{loading:r.loading,data:r.data,error:r.error,params:r.params,cancel:r.context.cancel,refresh:r.context.refresh,refreshAsync:r.context.refreshAsync,mutate:r.context.mutate,run:r.context.run,runAsync:r.context.runAsync}}const M=new Map,Te=(e,t)=>{M.set(e,t),t.then(n=>(M.delete(e),n)).catch(()=>{M.delete(e)})},be=e=>M.get(e),N=new Map,_e=(e,t)=>{N.has(e)&&N.get(e).forEach(n=>n(t))},Pe=(e,t)=>(N.has(e)?N.get(e).push(t):N.set(e,[t]),()=>{const n=N.get(e).indexOf(t);N.get(e).splice(n,1)});var ye=A((e,{cacheKey:t,cacheTime:n=6e5,staleTime:o=0,getCache:a,setCache:i})=>{if(!t)return{};const s=z(t)?t:()=>t,r=b(()=>{});let u;const l=c=>a?a(c):le(c),g=(c,h,v)=>{i?i(c,v):ce(c,h,v),_e(c,v.data)},w=c=>o===-1||c+o>new Date().getTime(),m=(c,h)=>Object.prototype.hasOwnProperty.call(c,h),E=c=>{const h=s(c);return Pe(h,v=>{e.data.value=v})},d=s(),p=l(d);return p&&m(p,"data")&&(e.data.value=p.data,e.params.value=p.params),d&&(r.value=E()),Q(()=>{r.value()}),{onBefore(c){const h=s(c),v=l(h);if(!v||!m(v,"data"))return{};if(w(v.time))return e.data.value=v.data,e.loading.value=!1,{isBreak:!0,breakResult:v.data};e.data.value=v.data},onQuery(c){const h=e.params.value,v=s(h);let T=be(v);return T&&T!==u?()=>T:(T=c(),u=T,Te(v,T),()=>T)},onSuccess(c,h){const v=s(h);v&&(r.value(),g(v,n,{data:c,params:h,time:new Date().getTime()}),r.value=E(h))},onMutate(c){const h=s(e.params.value);h&&(r.value(),g(h,n,{data:c,params:e.params.value,time:new Date().getTime()}),r.value=E(e.params.value))}}});function Ce(e){let t,n;class o extends Promise{constructor(i){super(i),this.cancel=()=>{n(),clearTimeout(t)}}}return new o(a=>{n=a,t=setTimeout(n,e)})}function W(){return new Date().getTime()}var Le=A((e,{loadingDelay:t=0,loadingKeep:n=0})=>{const o=b(()=>{}),a=y(()=>x(t)),i=y(()=>x(n));let s=0,r={};const u=()=>{let l;return a.value&&(l=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},a.value)),()=>l&&clearTimeout(l)};return{onBefore(){e.loading.value=!a.value,o.value(),o.value=u(),s=W()},onQuery(l){if(!i.value)return()=>l();r=Ce(i.value+a.value);const g=async()=>{try{const m=await l();return W()-s<=a.value&&r.cancel(),Promise.resolve(m)}catch(m){return W()-s<=a.value&&r.cancel(),Promise.reject(m)}},w=Promise.allSettled([g(),r]).then(m=>{const E=m[0];return E.status==="fulfilled"?E.value:Promise.reject(E.reason)});return()=>w},onCancel(){o.value()},onAfter(){o.value()}}}),k;const Z=new Set,q=new Set,ee=new Set,D=(e,t)=>{let n;switch(e){case"FOCUS_LISTENER":n=Z;break;case"RECONNECT_LISTENER":n=ee;break;case"VISIBLE_LISTENER":n=q;break}if(!n.has(t))return n.add(t),()=>{n.delete(t)}},V=e=>{e.forEach(t=>{t()})};!H&&(k=window)!==null&&k!==void 0&&k.addEventListener&&(window.addEventListener("visibilitychange",()=>{J()&&V(q)},!1),window.addEventListener("focus",()=>V(Z),!1),window.addEventListener("online",()=>V(ee),!1));var xe=A((e,{pollingInterval:t,pollingWhenHidden:n=!1,pollingWhenOffline:o=!1,errorRetryCount:a=0})=>{const i=b(),s=b(!1),r=y(()=>x(t)),u=y(()=>x(a)),l=[],g=d=>{d&&l.push(d)},w=()=>(n||J())&&(o||ie()),m=d=>{if(e.error.value&&u.value!==0)return;let p;if(!B(r.value)&&r.value>=0)if(w())p=setTimeout(d,r.value);else{s.value=!0;return}return()=>p&&clearTimeout(p)},E=()=>{s.value&&w()&&(e.context.refresh(),s.value=!1)};return G(r,()=>{i.value&&(i.value(),i.value=m(()=>e.context.refresh()))}),n||g(D("VISIBLE_LISTENER",E)),o||g(D("RECONNECT_LISTENER",E)),Q(()=>{l.forEach(d=>d())}),{onBefore(){var d;(d=i.value)===null||d===void 0||d.call(i)},onCancel(){var d;(d=i.value)===null||d===void 0||d.call(i)},onAfter(){i.value=m(()=>e.context.refresh())}}});const Ae=(e,t)=>{let n=!1;return(...o)=>{n||(n=!0,e(...o),setTimeout(()=>{n=!1},t))}};var Oe=A((e,{refreshOnWindowFocus:t=!1,refocusTimespan:n=5e3})=>{const o=y(()=>x(t)),a=y(()=>x(n)),i=[],s=u=>{u&&i.push(u)},r=()=>{i.forEach(u=>u())};return U(()=>{if(r(),o.value){const u=Ae(e.context.refresh,a.value);s(D("VISIBLE_LISTENER",u)),s(D("FOCUS_LISTENER",u))}}),Q(()=>{r()}),{}});function Ie(e,t){return pe(e,t,[Le,ve,de,xe,he,Oe,ge,me,ye])}export{Ie as u};
