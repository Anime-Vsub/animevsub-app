import{aW as U,b4 as D,a1 as G,H as O,bl as s,bh as i,bc as b,be as y,bg as d,bi as e,bu as T,bv as g,bw as u,bm as w,bn as W,bo as c,bx as _,bj as m,bk as B,bd as R,A as C}from"./index.b340747c.js";import{u as J,r as K,a as v}from"./urlImage.0db39262.js";import"./dayjs.937bb0b8.js";const Q=U("playlist",()=>{const r=D(),h=G(null),[P,E]=J(O(()=>{if(h.value=null,!r.uid)return null;const t=s(i,"users",r.uid);return b(d(t,"playlist"),y("created","desc"))}),null,{errorHandler(t){h.value=t}});async function q(t,o){if(!r.uid)throw new Error(e.global.t("errors.require_login_to",[e.global.t("tao-danh-sach-phat")]));const a=s(i,"users",r.uid);return T(d(a,"playlist"),{name:t,public:o,created:c(),size:0})}async function x(t){if(!r.uid)throw new Error(e.global.t("errors.require_login_to",[e.global.t("xoa-danh-sach-phat")]));const o=s(i,"users",r.uid);return g(s(o,"playlist",t))}async function A(t,o){if(!r.uid)throw new Error(e.global.t("errors.require_login_to",[e.global.t("xoa-danh-sach-phat")]));const a=s(i,"users",r.uid);return u(s(a,"playlist",t),{name:o})}async function z(t,o){if(!r.uid)throw new Error(e.global.t("errors.require_login_to",[e.global.t("xoa-danh-sach-phat")]));const a=s(i,"users",r.uid);return u(s(a,"playlist",t),{description:o})}async function F(t,o){if(!r.uid)throw new Error(e.global.t("errors.require_login_to",[e.global.t("xoa-danh-sach-phat")]));const a=s(i,"users",r.uid);return u(s(a,"playlist",t),{public:o})}async function H(t,o,a){if(!r.uid)throw new Error(e.global.t("errors.require_login_to",[e.global.t("theo-vao-danh-sach-phat")]));const l=s(i,"users",r.uid),n=s(l,"playlist",t);if(!(await w(n)).exists())throw new Error(e.global.t("errors.danh-sach-phat-khong-ton-tai"));await W(s(n,"movies",`${o}`),{...a,poster:K(a.poster),add_at:c()},{merge:!0}),await u(n,{size:_(1),updated:c()})}async function S(t,o){if(!r.uid)throw new Error(e.global.t("errors.require_login_to",[e.global.t("theo-vao-danh-sach-phat")]));const a=s(i,"users",r.uid),l=s(a,"playlist",t);await g(s(l,"movies",o)),await u(l,{size:_(-1),updated:c()})}async function k(t,o){if(!r.uid)throw new Error(e.global.t("errors.require_login_to",[e.global.t("theo-vao-danh-sach-phat")]));const a=s(i,"users",r.uid),l=s(a,"playlist",t);return w(s(l,"movies",`${o}`)).then(n=>n.exists())}async function $(t,o,a){if(!r.uid)throw new Error(e.global.t("errors.require_login_to",[e.global.t("theo-vao-danh-sach-phat")]));const l=s(i,"users",r.uid),n=s(l,"playlist",t);return m(b(d(n,"movies"),y("add_at",a!=null?a:"asc"),...o?[B(o)]:[],R(20))).then(I=>I.docs.map(f=>{const p=f.data();return{...p,poster:v(p.poster),$doc:f,season:f.id,add_at:C(p.add_at.toDate())}}))}async function j(t){if(!r.uid)throw new Error(e.global.t("errors.require_login_to",[e.global.t("theo-vao-danh-sach-phat")]));const o=s(i,"users",r.uid);return m(b(d(o,"playlist",t,"movies"),y("add_at","asc"),R(1))).then(a=>{var l,n;return(n=(l=a.docs)==null?void 0:l[0].data().poster)!=null?n:null}).then(a=>a&&v(a))}return{playlists:P,playlistsError:h,refreshPlaylists:E,createPlaylist:q,deletePlaylist:x,renamePlaylist:A,setDescriptionPlaylist:z,publicPlaylist:F,getPosterPlaylist:j,addAnimeToPlaylist:H,deleteAnimeFromPlaylist:S,hasAnimeOfPlaylist:k,getAnimesFromPlaylist:$}});export{Q as u};
